# 0413 수요일 1:N 보충

테이블간의 연관이 있다 -> 릴레이션이 있다.

무결성 (결점이 없다, 잘못된 데이터가 들어가면 안됨)

![image-20220413184059469](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413184059469.png)



그래서 DB 제약사항을 (constraint)설정함

![image-20220413184331844](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413184331844.png)

article user필드에 제약사항은상단 data base에 있는 값만 넣어줄 수 있어!



![image-20220413184851714](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413184851714.png)





## 1 : N ?

게시글 하나에 댓글 여러개

유저와 게시글 관계

유저와 커멘트간의 관계

![image-20220413185033765](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413185033765.png)

N에 해당하는 곳에 1을 써주면됨

![image-20220413185405426](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413185405426.png)



데이터 취합 후 정규화

![image-20220413185645170](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413185645170.png)



 cascade는 article이 삭제되면 comment도 같이 삭제



---



article 인스턴스를 comment.article로 집어넣음

이러면 id도 같이 저장됨

![image-20220413190555348](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413190555348.png)



![image-20220413191209399](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413191209399.png)







![image-20220413191500579](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413191500579.png)

input 타입 hidden으로 전달하면 화면에 나타나지않아도 서버에 전달됨

![image-20220413191535839](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413191535839.png)

url통일성을 위해 pk를 받아옴. 무조건은 x

다른 방법이 있긴함.



![image-20220413191715295](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413191715295.png)

article이 필요해서 pk로 가져옴

폼으로 받아서comment인스턴스를 만들기 위해서 save로 만듦

![image-20220413191757424](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413191757424.png)



이렇게 하면 

예를 들어 commit= true 로 하면 article이 없으면 not null 에러가 뜸

![image-20220413192404462](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413192404462.png)

1번게시글의 나를참조 하고 있는 애를 다 가지고 와라! 이거를 장고가 다 알아서 해줌

이게 역참조이다. 

장고가 역참조 매니저를 만들어줌

![image-20220413192534185](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413192534185.png)

![image-20220413192631430](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413192631430.png)

게시글에서 나를 참조하는 모든애들을 가지고 와서 comments에 대입





## 삭제 

특정 댓글을 삭제하고 싶은거니까 comment.pk가 필요함

없어도 삭제는 가능하지만, 삭제하고 나서의 행동(삭제 후 게시글 보기 요청이 detaild임 )

![image-20220413192851731](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413192851731.png)redirect하기 위해서 pk가 필요함 



![image-20220413192923451](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413192923451.png)

article.pk redirect위한 pk

comment.pk 코멘트 삭제위한 pk



![image-20220413193004910](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413193004910.png)

라임맞추듯 맞추기 위해 path에 pk넣은것

![image-20220413193623557](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413193623557.png)

request도 기본 context에 포함되어있어서 굳이 안써도됨

request.user~~~도 맞음

![image-20220413193728835](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413193728835.png)

지금 로그인한 사람이 댓글 단 사람이냐

로그인은 요청정보에 유저정보가 저장되니까, request.user를 해야함



![image-20220413194402606](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413194402606.png)

![image-20220413194852800](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413194852800.png)

![image-20220413194913744](0413%20%EC%88%98%EC%9A%94%EC%9D%BC%201N%20%EB%B3%B4%EC%B6%A9.assets/image-20220413194913744.png)

