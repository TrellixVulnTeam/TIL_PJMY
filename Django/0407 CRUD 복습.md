# 0407 CRUD 복습

## 가상환경 및 세팅

1. 가상환경 구축하기

```bash
$ python -m venv venv
```



2. 가상환경 실행시키기

```bash
$ source venv/Scripts/activate 
```



3. interpreter 변경하기

ctrl+shift+p 로 ![image-20220407092513578](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407092513578.png)

가상환경 



4. `.gitignore` 파일 생성 후 

   gitignore.io 사이트에서 python, window, django, visual studio code 등을 넣어서 생성 후

   파일에 넣고 저장



5. pip list로 목록 확인하기

```bash
$ pip list
```



6. 버전에 맞는 `django` 설치

```bash
$ pip install django==3.2.10
```

6-1. `requirements.txt` 설치

* 재귀(리컬시브) 사용

``` bash
$ pip install -r requirements.txt
```



7. 패키지 설치했다면

![image-20220407100047982](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407100047982.png)

``` bash
$ pip freeze > requirements.txt
```





## 프로젝트 시작

1. 프로젝트 시작하기 (프로젝트 이름은 crud)

```bash
$ django-admin startproject crud .
```



2. 앱 생성 (앱 이름은 articles)

```bash
$ python manage.py startapp articles
```



3. 프로젝트의 settings.py 의 `INSTALLED_APPS`에 앱 추가 (순서 주의)
   * 코드 컨벤션 
     * 장고가 기본적으로 만든 것 위에 app을 넣어줌
     * 장고는 위에서 부터 먼저 찾는다.

![image-20220407093643677](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407093643677.png)



4. 프로젝트의 settings.py 시간, 언어 설정
   * 타임존 바꾸기 (기본으로 이정도만)

![image-20220407094042341](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407094042341.png)



![image-20220407093703923](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407093703923.png)





## models.py

1. 모델 작성

![image-20220407093755589](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407093755589.png)



2. makemigrations

``` bash
$ python manage.py makemigrations
```





3. migrate로 DB연동

``` bash
$ python manage.py migrate
```



4. 모델 변동

``` python
from django.db import models

# Create your models here.
class Article(models.Model):
    title = models.CharField(max_length=10)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    # print를 찍으면 title로 나오게끔 매직 매서드
    def __str__(self):
        return self.title
```

![image-20220407095320449](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407095320449.png)

* 파이썬 버전업으로 이렇게 적으면, str로 리턴될 것이라 명시 (참고)

![image-20220407095603570](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407095603570.png)



5. makemigrations

``` bash
$ python manage.py makemigrations
```



6. 1, enter (이거 문제였음)

![image-20220407094719888](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407094719888.png)



7. migrate

``` bash
$ python manage.py migrate
```





---

## admin 계정 설정

1. 계정 만들기

``` bash
$ python manage.py createsuperuser
```



2. admin / admin 1234 로 설정



3. admin.py에 등록 (admin 사이트에서 앱에 접근할 수 있게끔)

![image-20220407095939039](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407095939039.png)

``` python
from django.contrib import admin
from .models import Article
# Register your models here.

admin.site.register(Article)
```



4. 서버를 켜서 확인

![image-20220407100619418](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407100619418.png)





## template 

1. 기본 구조

![image-20220407101154663](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407101154663.png)





2. base.html에 
   * block 만들기
   * 부트스트랩 cdn 가져오기

![image-20220407101430842](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407101430842.png)



3. settings.py에 저장하기
   * 커서를 올린 채 ctrl 누르면, 경로가 보임

![image-20220407101445477](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407101445477.png)





## urls.py

1. 프로젝트(crud) 의 urls.py

```python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('articles/', include('articles.urls'))
]
```

![image-20220407102011967](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407102011967.png)



#### cf) Variable Routing

ex) Variable Routing의 개념을 활용한다. 저녁메뉴는 string, 인원수는 integer이다.

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('dinner/<str:menu>/<int:people>', views.dinner),
]
```



2. 앱(articles)의 urls.py

``` python
from django.urls import path
from . import views

# 앱이름
app_name = 'articles'

# urls
urlpatterns = [
    path('', views.index, name='index'),
]
```

![image-20220407102620304](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407102620304.png)



### cf) app_name - app이 여러개일 때, 여러개의 앱에서 동일한 name을 사용하고 싶다면 

> articles:index 
> `다른 앱:index` 

이렇게 url을 쓰려고

---



### `urls.py`한번에 적기

> 









## views.py

1. index

``` python
from django.shortcuts import render
from .models import Article
# Create your views here.

def index(request):
    return render(request, 'articles/index.html')
```

![image-20220407105810615](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407105810615.png)



2. index를 편집해서 model에서 쿼리셋을 가져오는 코드 (read)

![image-20220407110756053](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407110756053.png)

![image-20220407130929452](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407130929452.png)

* orm chainning

![image-20220407131110404](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407131110404.png)



> GET 방식 - 주소창에서 볼 수 있음 - 쿼리스트링 ? 키 =벨류
>
> POST 방식 - csrf token



3. new(create)

![image-20220407125425663](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407125425663.png)



4. create

![image-20220407125625041](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407125625041.png)



![image-20220407125439872](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407125439872.png)





## template

1. index.html

``` python
{% extends 'base.html' %}

{% block content%}
<h1 class="text-center"> hello! </h1>
{% endblock content%}
```



![image-20220407105922347](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407105922347.png)



2. index.html 수정 (read)

![image-20220407110815362](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407110815362.png)

![image-20220407110903458](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407110903458.png)



3. new(create)

![image-20220407111504120](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407111504120.png)

``` html
{% extends 'base.html' %}

{% block content%}
  <h1 class="text-center"> NEW(CREATE) </h1>
  
  <form action="#" method="GET"> 
    <label for="title">제목</label>
    <input type="text" id="title" name="title"><br>
    
    <lable for="content">내용</label>
    <textarea id="content" name="content" cols="30" rows="5"> </textarea><br>  
  
    <input type="submit"><br>
  </form>
  <a href={% url 'articles:index' %}> [글 목록] </a>
{% endblock content%}
```

![image-20220407113019576](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407113019576.png)





4. create

![image-20220407131650474](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407131650474.png)



``` html
{% extends 'base.html' %}

{% block content%}
  <h1 class="text-center"> 성공적으로 작성됨! </h1>
  <a href={% url 'articles:index' %}> [글 목록] </a>
{% endblock content%}
```





---

# 그런데 우리는 GET이 아니라 POST방식을 써야함

views와 news.html create.html을 바꾸자

> views 에서 POST 방식 추가에 따른 create 함수 변경 / redirect 추가

![image-20220407132752880](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407132752880.png)

``` python
from django.shortcuts import render, redirect
from .models import Article
# Create your views here.

def index(request):
    articles = Article.objects.order_by('-pk')
    content = {
        'articles' : articles
    }
    return render(request, 'articles/index.html', content)

# new, create가 create하는 함수들
def new(request):
    return render(request, 'articles/new.html')

def create(request):
    title = request.POST.get('title')
    content = request.POST.get('content')
    article= Article(
        title=title,
        content=content
    )
    article.save()
    return redirect('articles:index')
```



news.html 에서 6 7번 라인 수정

![image-20220407132430951](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407132430951.png)

``` html
{% extends 'base.html' %}

{% block content%}
  <h1 class="text-center"> NEW(CREATE) </h1>
  
  <form action="{% url 'articles:create' %}" method="POST"> 
    {% csrf_token %}
    <label for="title">제목</label>
    <input type="text" id="title" name="title"><br>
    
    <lable for="content">내용</label>
    <textarea id="content" name="content" cols="30" rows="5"> </textarea><br>  
  
    <input type="submit"><br>
  </form>
  <a href={% url 'articles:index' %}> [글 목록] </a>
{% endblock content%}
```



> create.html 

![image-20220407132412983](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407132412983.png)

``` html
{% extends 'base.html' %}

{% block content%}
  <h1 class="text-center"> 성공적으로 작성됨! </h1>
  <a href={% url 'articles:index' %}> [글 목록] </a>
{% endblock content%}
```



> create.html 이 필요 없어짐

삭제 !



---

# detail을 만들자

1. url 

![image-20220407132905431](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407132905431.png)



2. view

![image-20220407133239035](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407133239035.png)



3. template 

> detail.html

![image-20220407133708361](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407133708361.png)



>index.html에서 글제목을 눌렀을 때 detail 페이지로 가기

9번 라인 수정 article.pk도 넘겨주어야함

![image-20220407134747549](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407134747549.png)



> 이제는 글쓰기에서 index가 아닌 상세 페이지 detail로 가~

![image-20220407135303589](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407135303589.png)





-------------> CR 구현 완

---

# delete 를 구현하자

> url

![image-20220407135429240](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407135429240.png)





> views

![image-20220407140308686](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407140308686.png)



> detail.html 수정 (글 삭제하기)

* a 태그로 하면 동작은 잘 되겠지만 get방식의 요청이라서 주소줄에서 지울 수가 있음

![image-20220407135925475](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407135925475.png)

* post방식인 form을 써서 구현하기 (17~20줄)

![image-20220407140400524](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407140400524.png)



#### 하지만, 아직도 주소줄에서 삭제가 가능하다 어떻게 해야할까?

> views 수정

* get일때는 상세페이지
* post일때는 글 삭제

![image-20220407142604453](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407142604453.png)

---



# update 

> url

edit 추가

![image-20220407142740723](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407142740723.png)





> view

![image-20220407144422564](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407144422564.png)





> edit.html (new 템플릿)

글 작성과 글 수정은 템플릿이 똑같음

but 기존 작성한 내용이 채워져 있어야함 ==> value속성

* input은 value로  9번째 라인
* textarea는 그냥  12번째 라인

![image-20220407143526992](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407143526992.png)





>수정이 된게 아니라 왜 새로써졌을까???? 위에 6번 라인

![image-20220407143446862](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407143446862.png)

이유는

![image-20220407143903980](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407143903980.png)





> edit 

6번째 #으로 변경

![image-20220407144305786](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407144305786.png)



> detial 글 수정 a태그 추가





### update 추가

> url

update 추가

![image-20220407144400869](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407144400869.png)





> view

![image-20220407144529740](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407144529740.png)

![image-20220407145305838](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407145305838.png)





> edit 템플릿 

6번 줄 action , 9번 줄 value

![image-20220407145229233](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407145229233.png)







---

![image-20220407145720952](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407145720952.png)

![image-20220407145751384](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407145751384.png)





---

# Form (ppt내용)

* 참고

![image-20220407150234062](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407150234062.png)

---

## new의 Form을 대체할 것임

1. articles에 forms.py를 생성

``` python
from django import forms

class ArticleForm(forms.Form):
    title = forms.CharField(max_length=10)
    content = forms.CharField()
    
```



![image-20220407150549943](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407150549943.png)





2. views.py에 와서,

new에서 사용할 수 있음 new는 새로운 글을 작성할 때 비어있는 form을 보여주기 위한 url

3번 라인 추가, new 함수 변경

![image-20220407150744112](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407150744112.png)





3. new.html

* 9번 라인에 dtl로 form사용함

![image-20220407150952730](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407150952730.png)







## 위젯

폼 필드는 장고 템플렛에서 유효성 검사를 할수 있는 인픗태그를 생성해주는 것

위젯은 사용자에게 어떤 모습으로 보여질지에 해당한다

서로 다른것임



> forms.py 에서 위젯 추가

![image-20220407151736404](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407151736404.png)

![image-20220407151824389](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407151824389.png)

textarea 늘렸다 줄였다 장고가 해주는게 아니라 크롬 브라우저가 해주는 것이다.





> chioce

``` python
from django import forms

class ArticleForm(forms.Form):
    REGION_A = "sl"
    REGION_B = "dj"
    REGION_C = "gj"
    REGION_D = "gm"
    REGION_E = "bu"
    REGION_CHOICES = [
        (REGION_A, '서울'),
        (REGION_B, '대전'),
        (REGION_C, '광주'),
        (REGION_D, '구미'),
        (REGION_E, '부산'),
    ]
    title = forms.CharField(max_length=10)
    content = forms.CharField(widget=forms.Textarea)
    region = forms.ChoiceField(choices=REGION_CHOICES, widget=forms.Select())

```







![image-20220407152619776](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407152619776.png)





## modelform

![image-20220407155021454](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407155021454.png)

메타클래스를 써서 모델폼한테 정보를 제공해주는 거구나.





veiw의 create를 변경해보자

![image-20220407155224520](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407155224520.png)

28번 라인이 30~32라인과 같음

![image-20220407160215166](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407160215166.png)

form.save()로 해당 인스턴스를 article로 반환해준다.

![image-20220407160025899](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407160025899.png)







#### new+create  두개가 하나로 합쳐짐

![image-20220407160622796](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407160622796.png)



> create함수

![image-20220407160806753](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407160806753.png)



> new.html을 create.html로 이름 변경후 안에 내용도 변경

![image-20220407161429461](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407161429461.png)





> index.html 변경 (a태그는 get방식)

![image-20220407161156167](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407161156167.png)





![image-20220407214226696](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407214226696.png)

form.errors로 에러 확인 가능

![image-20220407214313626](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407214313626.png)

입력값 확인하라고 한글로도 뜸



![image-20220407214839535](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407214839535.png)

![image-20220407215232931](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407215232931.png)

request.method확인하기

![image-20220407215300468](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407215300468.png)

![image-20220407215252495](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407215252495.png)

POST방식







## create 함수 짜는 법

![image-20220407215424216](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407215424216.png)

1. 만약에 request.method가 post라면 (create함수의 일을 수행)
   1. 

2. post가 아닐때라면 (new함수의 일을 수행)

![image-20220407215657261](0407%20CRUD%20%EB%B3%B5%EC%8A%B5.assets/image-20220407215657261.png)





---

## update함수 짜기

함수 짜고 

edit url지우고, 

html 템플릿에서 edit -> update로 바꾸기



