## day01

4/14 prac (투표)



> tmdb api

* 사용자가 영화이름을 선택하면 리스트로 나오고 
* 그 중에 하나를 선택하면 무비 아이디로 가져옴

https://developers.themoviedb.org/3/search/search-movies



* user table

|           |      |      |      |      |
| --------- | ---- | ---- | ---- | ---- |
| user_name |      |      |      |      |
| email     |      |      |      |      |
| password  |      |      |      |      |
|           |      |      |      |      |
|           |      |      |      |      |
|           |      |      |      |      |
|           |      |      |      |      |
|           |      |      |      |      |
|           |      |      |      |      |



* movie table (tmdb)

|              |      |      |      |      |
| ------------ | ---- | ---- | ---- | ---- |
| id           |      |      |      |      |
| title        |      |      |      |      |
| poster_path  |      |      |      |      |
| overview     |      |      |      |      |
| release_date |      |      |      |      |
| genres       |      |      |      |      |
| user         |      |      |      |      |
|              |      |      |      |      |
|              |      |      |      |      |



* vote table

| id         |      |      |      |      |
| ---------- | ---- | ---- | ---- | ---- |
| title      |      |      |      |      |
| content    |      |      |      |      |
| created_at |      |      |      |      |
| updated_at |      |      |      |      |
| select     | 투표 |      |      |      |
|            |      |      |      |      |
|            |      |      |      |      |
|            |      |      |      |      |
|            |      |      |      |      |



* comment table

| id      |      |      |      |      |
| ------- | ---- | ---- | ---- | ---- |
| content |      |      |      |      |
| movie   |      |      |      |      |
| user    |      |      |      |      |
|         |      |      |      |      |
|         |      |      |      |      |
|         |      |      |      |      |
|         |      |      |      |      |
|         |      |      |      |      |
|         |      |      |      |      |

![image-20220519090947195](01.assets/image-20220519090947195.png)



관리자 뷰 - 4번 url 연결하라는 소리

![image-20220519091214943](01.assets/image-20220519091214943.png)

랜덤인지, 좋아요 누른거에 대한 랜덤인지, 

![image-20220519091352438](01.assets/image-20220519091352438.png)

![image-20220519091502608](01.assets/image-20220519091502608.png)



200 404

회원가입 201

상태코드 상황에 맞게 반환

![image-20220519091706001](01.assets/image-20220519091706001.png)

![image-20220519092220922](01.assets/image-20220519092220922.png)

느낀점

어떤 에러를 어떠한 방식으로 어떻게 해결했는지

혼자개발, 둘이개발 어떤게 달랐고 뭐가어려웠는지





## day02 (0518 수요일 DB 구조를 잡는게 너무 어려웠다....)

프로젝트 : movieproject

앱 : Account, Community , Movie 

![image-20220519173449621](01.assets/image-20220519173449621.png)

`앱 : 테이블`

account : User

Community : Article, Comment, Choice, Vote

Movie : Genre, Movie

----

![image-20220519173659037](01.assets/image-20220519173659037.png)

![image-20220519173715715](01.assets/image-20220519173715715.png)

---

시나리오 : 

* tmbi api를 통해서 영화의 장르, 각 영화를 받아옴,
* 사이트에서 영화를 검색할 수 있다. 
* 장르로 영화를 추천받을 수 있다.

* 유저는 회원가입, 로그인을 통해 영화 게시물을 작성할 수 있다. (구글api 로그인 기능을 사용할 수 있음)

* 유저는 회원 정보를 수정할 수 있다.

  

* 게시물의 내용은 A / B를 투표하는 것으로, 제목,  A / B에 대한 내용, 사진이 들어간다. (제목, 내용은 필수 / 사진은 없다면, 기본 값) - content_a, content_b

* 게시물은 쓴 사람만 지울 수 있다.

* 한명의 유저는 여러개의 게시물에 [좋아요 버튼]을 누를 수 있다. - 토글 가능

* 하나의 게시글에는 여러개의 댓글을 알 수 있고 대댓글을 달 수 있다.

* 댓글도 쓴 사람만 지울 수 있다.

  

  

![image-20220519170243430](01.assets/image-20220519170243430.png)

### user : article = 1 : N

하나의 user는 여러개의 article을 생성할 수 있다.

한 개의 article은 하나의 user만 작성할 수 있다.



### user : vote = N : M

하나의 user는 여러개의 vote를 생성할 수 있다. 

하나의 article에서 여러명의 user가 vote할 수 있다. 



### article : comment= 1 : N

한 개의 article은 여러 개의 comment를 작성할 수 있다.

한 개의 comment는 한 개의 article에서만 작성된다.



### movie : article = 1 : N

한 개의 movie는 여러개의 article을 생성할 수 있다.

한 개의 article은 하나의 movie를 가질 수 있다.



### movie : genre = 1 : N

한 개의 movie는 여러개의 genre 을 생성할 수 있다.

한 개의 genre은 하나의 movie를 가질 수 있다.



### day03 (0519 목요일)

---

#### 내가 만난 에러

![image-20220519135500311](01.assets/image-20220519135500311.png)

ERRORS:
articles.Article.img_a: (fields.E210) Cannot use ImageField because Pillow is not installed.
django.core.management.base.SystemCheckError: SystemCheckError: System check identified some issues:



해결 : pip install Pillow

---



### tmdb api 

https://velog.io/@shawnk123/TMDB-API-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EC%98%81%ED%99%94-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0



![image-20220519153829367](01.assets/image-20220519153829367.png)

![image-20220519160946841](01.assets/image-20220519160946841.png)

---

#### 내가 만난 오류 : 코드 의존성



  File "C:\Users\star3\OneDrive\바탕 화면\final-pjt\final-pjt-back\community\models.py", line 3, in <module>
    from movies.models import Movie
  File "C:\Users\star3\OneDrive\바탕 화면\final-pjt\final-pjt-back\movies\models.py", line 2, in <module>
    from community.models import Article
ImportError: cannot import name 'Article' from partially initialized module 'community.models' (most likely due to a circular import) (C:\Users\star3\OneDrive\바탕 화면\final-pjt\final-pjt-back\community\models.py)
(venv)
star3@starmoon MINGW64 ~/OneDrive/바탕 화면/final-pjt/final-pjt-back (be-dev)

오류

![image-20220519180220751](01.assets/image-20220519180220751.png)코드가 점점 커지다 보니 의존성문제가 발생하기 시작했다. models.py 사이에서 import로 얽힌 연관성이 무한하게 반복된 것이다. django가 import를 무한하게 반복하게 되어 발생하는 문제다.
특히 foreign key 관계에서 자주 발생한다. 

 

예를 들어 방금의 경우엔 from accountapp.models import User 여기서 에러가 발생했다.
이런경우엔 지워주고 import accountapp 만 해준후에
원래라면 모델에서 User로 넣어줬을 것을 accountapp.User 이런식으로 넣어주면 된다. 해당모델을 필요시에만 임포트해오기 때문에 circular dependency 문제를 피할 수 있다.

**Foreign key 를 사용할때는 습관적으로 이렇게 작성해주자. 당장에 문제가 없더라도 이런 문제는 언제든 발생할 수 있다.** 

 

\* 이렇게해도 문제가 생기는 경우가 있다.

예를 들어 accountapp에 User라는게 없다고 에러를 내는 경우이다. 해당 경우엔 콜론을 씌워주면 해결된다. 이유는 모르고 이런 문법에 대해서도 검색결과를 딱히 찾지 못하기도 했지만 어찌되었든 내 경우엔 그렇게 했더니 해결되었다. 
ex) accountapp.User -> 'accountapp.User'



---

### allauth로 생긴 url들

``` python
api/v1/comunity/
api/v1/accounts/ profile/<username>/
api/v1/accounts/ password/reset/ [name='rest_password_reset']
api/v1/accounts/ password/reset/confirm/ [name='rest_password_reset_confirm']
api/v1/accounts/ login/ [name='rest_login']
api/v1/accounts/ logout/ [name='rest_logout']
api/v1/accounts/ user/ [name='rest_user_details']
api/v1/accounts/ password/change/ [name='rest_password_change']
api/v1/movies/
api/v1/accounts/signup/
```



* postmans profile

![image-20220519203339051](01.assets/image-20220519203339051.png)

헤더에 담아보내기

Authorization

Token f265553260ad21209e59cf0071cd4a04ef4f1392

![image-20220519203402200](01.assets/image-20220519203402200.png)

* postmans 





* postmans signup

http://127.0.0.1:8000/api/v1/accounts/signup/

![image-20220519212818314](01.assets/image-20220519212818314.png)

비밀번호를 다르게 

![image-20220519214158863](01.assets/image-20220519214158863.png)

not ㅐ

![image-20220519214343416](01.assets/image-20220519214343416.png)



![image-20220519214358201](01.assets/image-20220519214358201.png)

slow 3g

로딩애니메이션



spinners

![image-20220519214636795](01.assets/image-20220519214636795.png)

![image-20220519221102196](01.assets/image-20220519221102196.png)

roboto

input 

margin 20 px / 

input border-bottom 만 활성화 , 색깔지정,

 

placeholder 로 하기



### day04



![image-20220520125345759](01.assets/image-20220520125345759.png)





![image-20220520135508072](01.assets/image-20220520135508072.png)



headers에 ![image-20220520135633712](01.assets/image-20220520135633712.png)

params에 search_data 해리



https://console.cloud.google.com/apis/credentials?hl=ko&project=sunlit-cab-349203

구글 로그인

https://velog.io/@gahyeon8955/Django-%EC%86%8C%EC%85%9C-%EB%A1%9C%EA%B7%B8%EC%9D%B8-Google



구글 api키

994273757355-tdasii9b46aqmjok0tl8osia4hdqs6u1.apps.googleusercontent.com

AIzaSyB8Vti_XlFN-lQHStsiYKnPtTerR-P3TIY

![image-20220520224233327](01.assets/image-20220520224233327.png)

http://127.0.0.1:8000/accounts/google/login/

http://127.0.0.1:8000/accounts/google/login/callback/

http://127.0.0.1:8000/accounts/google/google/login/callback/

## 400 오류: redirect_uri_mismatch


앱이 Google의 OAuth 2.0 정책을 준수하지 않기 때문에 앱에 로그인할 수 없습니다.

앱 개발자라면 Google Cloud Console에서 리디렉션 URI를 등록하세요.





-----------------

## 네이버 소셜 로그인

django 공식문서

https://django-allauth.readthedocs.io/en/latest/providers.html#naver

유튜브

https://www.youtube.com/watch?v=85X_fDK9OIo&list=PLEYmkoTDkhFwshtF_c00ZE8BbwsEoVQQg



네이버 개발자 링크

https://developers.naver.com/apps/#/wizard/register

ㅇㅇㅇㅇ

콜백 함수 KK

http://localhost:8000/accounts/naver/login/callback/

이것을 아래로 교체

http://127.0.0.1:8000/accounts/naver/login/callback/



애플리케이션 정보

![image-20220520235456548](01.assets/image-20220520235456548.png)

kPY2miw1SZDEWLAuQRoa

OoaEIXSJSH





## day04

## though 옵션

* though = '내가 사용할 테이블'
* 내가 사용할 테이블 정의 (내 프로젝트 상에서는 user, article 둘다 FK로 )

* 중복방지 복합키같은,,? 튜플로 쓰는 이유는 수정불가능이라서

class Meta:

​	unique_together = (("user", "article"),)

---

unique_together = (("user", "article", "choice"),)







----



![image-20220521151440071](01.assets/image-20220521151440071.png)



restful api 규칙 - > search = 캐리비안에서 왜 따옴표가 없는지 알수있음

![image-20220521154319305](01.assets/image-20220521154319305.png)

![image-20220521154303386](01.assets/image-20220521154303386.png)







movies 리스트 출력하는 법

![image-20220521155114545](01.assets/image-20220521155114545.png)





swagger -api 문서 만들기



---

![image-20220521162121111](01.assets/image-20220521162121111.png)

![image-20220521162132439](01.assets/image-20220521162132439.png)





```
# 두개 이상 - 쿼리셋

articles = Article.objects.all() 

# 한개 - 인스턴스, 오브젝트
article = Article.objects.filter(id=1).first()
```

'

----

클라이언트에서 request(요청)을 줄 때 json을 넘기면,

서버가 dict 타입의 데이터로 받음

서버는 view에서 로직처리를 하고 return response(응답 반환)



form-data : html form tag에서 input에 들어오는 값

```
{
	"키" : 벨류,
}
```

형태로 들어온다.



raw로 html에서 넘어오는건 form태그가 아닌 것에서 넘어옴 

![image-20220521170923122](01.assets/image-20220521170923122.png)

parameter는 form으로 넘어오는 정보 이외의 클라이언트가 서버한테 주는 형태





post로 온 것은 request.data 로 받아야하고

get으로 온 것은 request.GET으로 받아야한다





 articles = Article.objects.all().order_by('-pk')

![image-20220521173552923](01.assets/image-20220521173552923.png)







![image-20220521181412373](01.assets/image-20220521181412373.png)

![image-20220521184854141](01.assets/image-20220521184854141.png)





### day05

![image-20220522144844169](01.assets/image-20220522144844169.png)

1. ```json
   {
       "pk": 0,
       "user": 1,
       "title": "string",
       "movie" : {
           "title": "str",
           "overview": "str",
           "release_date": "str",
           "vote_average": "str",
           "poster_path": "str",
           "genre": "string"
       },
       "choices": [
           {
               "content": "string",
               "image": "string"
           },
           {
               "content": "string",
               "image": "string"
           }
       ],
       "comments": [
           {
               "comment": "string"
           }
       ]
   }
   ```

many = True를 주면, `[ ]`로 감싸짐



---

restful api에서는 url상에서 c,r,u,d 를 적으면 안됨

행위 메소드를 url에 포함하지 않는다.





---

204는 바디에 아무것도 담지않는게 204코드인데,

그러면 프론트에서 data에 설정한 메세지를 받지않아서, 삭제가 되었다라는 걸 알 수없음

어떤게 삭제가 되었다라는 걸 알고 싶어하는 경우가 많아서 협업할 때는 200코드로 보내줘서, data값을 알려줘야함

![image-20220522152744222](01.assets/image-20220522152744222.png)





404가 없는 페이지, not found인데 

프론트 입장에서는 그럼 호출이 안된거라고 생각할 수 있다.



400 이 잘못된 요청(예를 들어서 내가 pk가 1인 값을 찾는데, 그 값이 없을 경우)







![image-20220522161546065](01.assets/image-20220522161546065.png)



![image-20220522161559430](01.assets/image-20220522161559430.png)







``` json
{
    "movie_pk": 19995,
    "title": "제목",
    "choices": [
        {
            "content": "11111",
            "img": "file"
        },
        {
            "content": "22222",
            "img": "file"
        }
    ]
    
}
```

![image-20220522162316011](01.assets/image-20220522162316011.png)









``` json
{
    "article_pk" : 6,
    "movie_pk": 19995,
    "title": "제목바뀜",
    "choices": [
        {
            "content": "11111",
            "img": "file"
        },
        {
            "content": "22222",
            "img": "file"
        }
    ]
    
}
```

![image-20220522163014396](01.assets/image-20220522163014396.png)

article_pk를 db에서 볼것,

그리고 preview에서 에러가 날때는 article_pk를 주소에 `<>`로 넣어줘야함





annote

https://cocook.tistory.com/143



![image-20220523102859741](01.assets/image-20220523102859741.png)

![image-20220523102918848](01.assets/image-20220523102918848.png)



장르안에서 10개 중에서 3개 뽑기





* 검색 기능

영화별 검색 

투표많은순, 좋아요순, 최신순(생성시간), 





``` json
{
	"comment_pk": 6,
    "user" : 1
    "content": "댓글 바뀜",
}
```







### day 0523

![image-20220523110505929](01.assets/image-20220523110505929.png)

415Unsupported Media Type

Time:16 ms

Size:390 B

Save Response

Pretty

Raw

Preview

Visualize

JSON



json형식으로 바꿔주기

---





키 

34015f9c40f5b4702ab535604cd5784ea369cba4







## 에러 발생



AssertionError: The `request` argument must be an instance of `django.http.HttpRequest`, not `rest_framework.request.Request`.



`어노테이션 @ ` 오류 (안지워서 생긴 오류)





##### aggregate

# “django sort dictionary by key” Code Answer

![image-20220523162957179](01.assets/image-20220523162957179.png)







AttributeError: module 'django.db.models' has no attribute 'ListField'



액션 모험 판타지 SF

공포 미스터리 스릴러

661231

$ python manage.py migrate --run-syncdb





movie = Movie.objects.get(pk=article.movie_id)

참조하고 있을 때는 movie_id 이런 형식으로 접근해야함





select genre

from usergenrepoint

where user=request.user

group by genre

order by sum(activity)

limit 1;

